<!DOCTYPE html>
@{
    ViewBag.Title = "Loss Sounds";
    string saludo;
    var hora = DateTime.Now.Hour;
    if (hora < 12 && hora > 6)
    {
        saludo = "Buenos días";
    }
    else if (hora > 12 && hora < 20)
    {
        saludo = "Buenas tardes";
    }
    else
    {
        saludo = "Buenas noches";
    }
}
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>@ViewBag.Title</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.js" integrity="sha512-+k1pnlgt4F1H8L7t3z95o3/KO+o78INEcXTbnoJQ/F2VqDVhWoaiVml/OEHv9HsVgxUaVW+IbiZPUJQfF/YxZw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    @Styles.Render("~/Content/css")
    @Scripts.Render("~/bundles/modernizr")
</head>
<body>
    <div class="container">
        <header>
            <div class="general__bienvenida">
                <div class="hora">
                    <h1 class="general__bienvenida__bn">@saludo @Session["user"]</h1>
                    <h3 class="general__bienvenida__hora">@DateTime.Now.ToString("h:mm tt")</h3>
                </div>

                <div class="general__bienvenida__busqueda">
                    <form class="form">
                        <button>
                            <svg width="17" height="16" fill="none" xmlns="http://www.w3.org/2000/svg" role="img" aria-labelledby="search">
                                <path d="M7.667 12.667A5.333 5.333 0 107.667 2a5.333 5.333 0 000 10.667zM14.334 14l-2.9-2.9" stroke="currentColor" stroke-width="1.333" stroke-linecap="round" stroke-linejoin="round"></path>
                            </svg>
                        </button>
                        <input class="input" id="text-buscar" placeholder="Descubre nueva musica" required="" type="text">
                        <select class="input" id="opciones-cancion">
                        </select>
                        <button class="reset" type="reset">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </form>
                </div>

                <div class="general__bienvenida__logo">
                    <img src="../Content/Images/Logo.png">
                </div>
            </div>
        </header>
        <aside>
            <div class="menu">
                <button class="home" style="margin-left: 5%; margin-top: 5%;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" fill="currentColor" class="bi bi-house-door-fill" viewBox="0 0 16 16">
                        <path d="M6.5 14.5v-3.505c0-.245.25-.495.5-.495h2c.25 0 .5.25.5.5v3.5a.5.5 0 0 0 .5.5h4a.5.5 0 0 0 .5-.5v-7a.5.5 0 0 0-.146-.354L13 5.793V2.5a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5v1.293L8.354 1.146a.5.5 0 0 0-.708 0l-6 6A.5.5 0 0 0 1.5 7.5v7a.5.5 0 0 0 .5.5h4a.5.5 0 0 0 .5-.5" />
                    </svg>
                </button>
                <div class="menu__biblioteca">
                    <br /><br />
                    <h1 class="menu__biblioteca__letrero" style="margin-left:5%;"><a>Albumes</a></h1><br />
                    <button class="selectAlbum" onclick="redirectAlbum(this);">
                        <div class="biblioteca__album">
                            <input type="hidden" />
                            <img class="imgAlbum" /><b class="mostrar"></b>
                        </div><br>
                    </button>
                    <button class="selectAlbum" onclick="redirectAlbum(this);">
                        <div class="biblioteca__album">
                            <input type="hidden" />
                            <img class="imgAlbum" /><b class="mostrar"></b>
                        </div><br>
                    </button>
                    <button class="selectAlbum" onclick="redirectAlbum(this);">
                        <div class="biblioteca__album">
                            <input type="hidden" />
                            <img class="imgAlbum" /><b class="mostrar"></b>
                        </div><br>
                    </button>
                    <button class="selectAlbum" onclick="redirectAlbum(this);">
                        <div class="biblioteca__album">
                            <input type="hidden" />
                            <img class="imgAlbum" /><b class="mostrar"></b>
                        </div><br>
                    </button>
                    <button class="selectAlbum" onclick="redirectAlbum(this);">
                        <div class="biblioteca__album">
                            <input type="hidden" />
                            <img class="imgAlbum" /><b class="mostrar"></b>
                        </div><br>
                    </button>
                    <button class="selectAlbum" onclick="redirectAlbum(this);">
                        <div class="biblioteca__album">
                            <input type="hidden" />
                            <img class="imgAlbum" /><b class="mostrar"></b>
                        </div><br>
                    </button>

                </div>
            </div>
        </aside>

        <div class="contenido_general">
            @RenderBody()
        </div>


        <footer>
            <div class="reproductor">
                <div id="imagenContainer">
                    <img id="imagen" src="" alt="Imagen de la canción" style="width: 95px; height: 90px; align-items: center; margin-top: 6px;">
                </div>

                <div class="info" id="info">

                </div>
                <div class="controles">
                    <div class="btn_atras">
                        <button id="atras">
                            <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor" class="bi bi-skip-backward-fill" viewBox="0 0 16 16">
                                <path d="M.5 3.5A.5.5 0 0 0 0 4v8a.5.5 0 0 0 1 0V8.753l6.267 3.636c.54.313 1.233-.066 1.233-.697v-2.94l6.267 3.636c.54.314 1.233-.065 1.233-.696V4.308c0-.63-.693-1.01-1.233-.696L8.5 7.248v-2.94c0-.63-.692-1.01-1.233-.696L1 7.248V4a.5.5 0 0 0-.5-.5z" />
                            </svg>
                        </button>
                    </div>
                    <div class="btn_play">
                        <button id="play" class="imgPlay"><img src="~/Content/Images/play.png"></button>
                    </div>
                    <div class="btn_pausa">
                        <button id="pausa">
                            <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" fill="currentColor" class="bi bi-pause" viewBox="0 0 16 16">
                                <path d="M6 3.5a.5.5 0 0 1 .5.5v8a.5.5 0 0 1-1 0V4a.5.5 0 0 1 .5-.5zm4 0a.5.5 0 0 1 .5.5v8a.5.5 0 0 1-1 0V4a.5.5 0 0 1 .5-.5z" />
                            </svg>
                        </button>
                    </div>
                    <div class="btn_siguiente">
                        <button id="siguiente">
                            <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor" class="bi bi-skip-forward-fill" viewBox="0 0 16 16">
                                <path d="M15.5 3.5a.5.5 0 0 1 .5.5v8a.5.5 0 0 1-1 0V8.753l-6.267 3.636c-.54.313-1.233-.066-1.233-.697v-2.94l-6.267 3.636C.693 12.703 0 12.324 0 11.693V4.308c0-.63.693-1.01 1.233-.696L7.5 7.248v-2.94c0-.63.693-1.01 1.233-.696L15 7.248V4a.5.5 0 0 1 .5-.5z" />
                            </svg>
                        </button>
                    </div>
                </div>
                <div class="barra-reproduccion">
                    <input type="range" id="barra-progreso" min="1" max="100" value="5">

                </div>
                <div class="me-gusta">
                    <button id="likes">
                        <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor" class="bi bi-heart-fill" viewBox="0 0 16 16">
                            <path fill-rule="evenodd" d="M8 1.314C12.438-3.248 23.534 4.735 8 15-7.534 4.736 3.562-3.248 8 1.314z" />
                        </svg>
                    </button>
                </div>
            </div>
        </footer>

    </div>
    @Scripts.Render("~/bundles/jquery")
    @Scripts.Render("~/bundles/bootstrap")
    @RenderSection("scripts", required: false)
</body>
</html>
<script src="~/Scripts/blockui-master/jquery.blockUI.js"></script>
<script>
    const sound = new Audio();
    var pauseButton = $("#pausa");
    pauseButton.hide();
    var playButton = $("#play");
    var pauseButton = $("#pausa");
    var currentIndex = 0; // Índice de la canción actual
    var canciones = []; // Arreglo para almacenar las canciones
    var isPlaying = false; // Variable para controlar si la canción está reproduciéndose
    var currentPlaybackPosition = 0;

        $(document).ready(function () {
            RenderLoader();

            $.ajax({
                url: '@Url.Action("GetCanciones", "Home")',
                type: 'GET',
                dataType: 'json',
                success: function (data) {
                    canciones = data;
                    mostrarCancion(currentIndex);
                    checkAllResourcesLoaded();
                    //playSound(currentIndex);
                }
            });


             $.ajax({
                 url: '@Url.Action("GetAlbum", "Album")',
                 type: 'GET',
                 dataType: 'json',
                 success: function (data) {
                     // Obtener todos los elementos .biblioteca__album existentes
                     var albumContainers = $('.biblioteca__album');

                     // Iterar sobre los datos y reemplazar los nombres de los álbumes en los contenedores existentes
                     albumContainers.each(function (index) {
                         // Comprobar si hay un álbum correspondiente en los datos recibidos
                         if (data[index]) {

                             var idAlbum = data[index].ID_Album;
                             var inputHidden = $(this).find('input[type=hidden]');
                             inputHidden.val(idAlbum);

                             // Actualizar el contenido del contenedor con el nombre del álbum correspondiente
                             $(this).find('b').text(data[index].Nombre_album);

                             var imagen = $(this).find('.imgAlbum');

                             var imagenData = data[index].Caratula_Album;
                             var blob = new Blob([new Uint8Array(imagenData)], { type: "image/jpeg" });
                             var imageUrl = URL.createObjectURL(blob);
                             imagen.attr("src", imageUrl);
                             checkAllResourcesLoaded();

                         }
                     });
                 },
                 error: function (error) {
                     console.log(error);
                 }
             });
    });


    $("#siguiente").click(function () {
        currentIndex = (currentIndex + 1) % canciones.length;
        mostrarCancion(currentIndex);
        if (pauseButton.show()) {
            playButton.hide();
            playSound(currentIndex);
        } else {
            pauseButton.hide();
            pauseButton.show();
            playSound(currentIndex);
        }
    });

    $("#atras").click(function () {
        currentIndex = (currentIndex - 1 + canciones.length) % canciones.length;
        mostrarCancion(currentIndex);
        if (pauseButton.show()) {
            playButton.hide();
            playSound(currentIndex);
        } else {
            pauseButton.hide();
            pauseButton.show();
            playSound(currentIndex);
        }
    });

    $("#pausa").click(function () {
        // Guarda la posición de reproducción al pausar
        currentPlaybackPosition = sound.currentTime;

        // Pausa la canción y oculta el botón de pausa
        sound.pause();
        pauseButton.hide();
        playButton.show();
        isPlaying = false;
    });


    $("#play").click(function () {
        if (!isPlaying) {
            // Restaura la posición de reproducción almacenada al reproducir
            sound.currentTime = currentPlaybackPosition;

            // Reproduce la canción
            sound.play();

            // Muestra el botón de pausa y oculta el botón de reproducción
            pauseButton.show();
            playButton.hide();
            isPlaying = true;
        }
    });

    // Configuración inicial del input range
    var inputRange = document.getElementById("barra-progreso");


    // Evento para actualizar la barra de reproducción según el tiempo de la canción
    inputRange.addEventListener("input", function (event) {
        var value = parseFloat(event.target.value); // Obtener el valor actual de la barra

        // Calcular el tiempo de reproducción en función del valor de la barra
        var duration = sound.duration; // Duración total de la canción
        var currentTime = (duration * value) / 100; // Calcular el tiempo actual de reproducción

        // Actualizar el tiempo de reproducción de la canción
        sound.currentTime = currentTime;
    });

    // Evento para actualizar dinámicamente la barra de reproducción mientras se reproduce la canción
    sound.addEventListener("timeupdate", function () {
        var duration = sound.duration; // Duración total de la canción
        var currentTime = sound.currentTime; // Tiempo actual de reproducción

        // Calcular el porcentaje de avance de la canción
        var progress = (currentTime / duration) * 100;

        // Actualizar el valor de la barra de reproducción
        inputRange.value = progress;
    });






    function playSound(index) {

        var data = canciones[index];


        if (data.NombreCancion == "Walk") {
            sound.src = "https://ia601709.us.archive.org/21/items/03-walk/03%20-%20Walk.flac";
        } else if (data.NombreCancion == "Rich Flex") {
            sound.src = "https://ia902704.us.archive.org/6/items/01-rich-flex/01%20-%20Rich%20Flex.flac";
        } else if (data.NombreCancion == "Insaciable Amante") {
            sound.src = "https://ia601207.us.archive.org/9/items/01-insaciable-amante/01%20-%20Insaciable%20Amante.flac";
        } else if (data.NombreCancion == "Bank Account") {
            sound.src = "https://ia600506.us.archive.org/34/items/02-bank-account/02%20-%20Bank%20Account.flac";
        } else if (data.NombreCancion == "Let It Be (Take 28)") {
            sound.src = "https://ia601701.us.archive.org/35/items/13-let-it-be-take-28/13%20-%20Let%20It%20Be%20%28Take%2028%29.flac";
        } else if (data.NombreCancion == "Mucho Corazón") {
            sound.src = "https://ia601205.us.archive.org/9/items/08-mucho-corazon_202311/08%20-%20Mucho%20Coraz%C3%B3n.flac";
        }
        sound.play();
    }



        function mostrarCancion(index) {

            var contenedor = document.getElementById("info");
            contenedor.innerHTML = '';

            var data = canciones[index];

            var imagenData = data.Caratula;
            var imagen = $("#imagen");
            var blob = new Blob([new Uint8Array(imagenData)], { type: "image/jpeg" });
            var imageUrl = URL.createObjectURL(blob);
            imagen.attr("src", imageUrl);

            let template = "<div class='info' style='width: 130px; flex-direction: column; top: 50%; left: 50%;'>" +
                "<h5 class='nomCancion'>" + data.NombreCancion + "</h5>" +
                "<h6 class 'nomArtista'>" + data.NombreArtista + "</h6>" +
                "<h6 class='nomAlbum'>" + data.NombreAlbum + "</h6>" +
                "</div";

            // Agregar el nuevo contenido al contenedor 'info'
            contenedor.innerHTML = template;
        }


       function Buscador() {

        // Capturar el campo de entrada
    var $searchInput = $('#text-buscar');
    // Obtener el elemento select
    var $select = $('#opciones-cancion');

    // Evento para detectar cambios en el campo de entrada
    $searchInput.on('input', function () {
        var query = $(this).val(); // Obtener el valor ingresado por el usuario
        // Obtener datos desde el controlador y cargarlos en el select
        $.ajax({
            url: '@Url.Action("GetCancionList", "Home")',
            type: 'GET',
            dataType: 'json',
            data: {
                txt: query  // Pasar el valor ingresado por el usuario como parámetro
            },
            success: function (data) {
                // Limpiar opciones existentes
                $select.empty();

                // Agregar las nuevas opciones desde los datos recibidos
                $.each(data, function (index, item) {
                    $select.append($('<option>', {
                        value: item.Value,
                        text: item.Text
                    }));
                });
            },
            error: function (error) {
                console.error('Error al obtener datos desde el servidor:', error);
            }
        });

        });

    }



    function redirectAlbum(button) {
    var albumContainer = button.querySelector('.biblioteca__album');
    var inputHidden = albumContainer.querySelector('input[type=hidden]');
    var valorInput = inputHidden.value;
    // Generar la URL con el valor de valorInput y redirigir
    var url = '@Url.Action("Album", "Album")' + '?ID_ALBUM=' + encodeURIComponent(valorInput);
        window.location.href = url;

    }


    function RenderLoader() {
    $.blockUI({
        message: '<h1><img src="' + '@Url.Content("~/Content/Images/loading-12.gif")' + '" /></h1>',
        baseZ: 2147483647,
        css: {
            padding: 0,
            margin: 0,
            top: ($(window).height() - 400) / 2 + 'px',
            left: ($(window).width() - 400) / 2 + 'px',
            textAlign: 'center',
            border: 'none',
            backgroundColor: 'transparent', // Añadir esta línea para establecer el fondo transparente
            cursor: 'wait'
        },
    });
    }

    var totalResourcesToLoad = 2; // Número total de recursos a cargar (por ejemplo, canciones e imágenes)
    var loadedResources = 0; // Contador para los recursos cargados
    function checkAllResourcesLoaded() {
        loadedResources++;
        if (loadedResources === totalResourcesToLoad) {
            $.unblockUI(); // Desbloquear la interfaz una vez que todos los recursos estén cargados
        }
    }

$(".home").click(function () {
       window.location.href = '@Url.Action("HomePage", "Home")';

});



</script>

